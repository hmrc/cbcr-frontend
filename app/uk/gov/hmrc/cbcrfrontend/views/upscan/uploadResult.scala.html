@*
* Copyright 2021 HM Revenue & Customs
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*@

@import uk.gov.hmrc.auth.core.AffinityGroup
@import uk.gov.hmrc.auth.core.AffinityGroup.Organisation
@import uk.gov.hmrc.cbcrfrontend.model.{CBC701, ReportingRole}
@import uk.gov.hmrc.cbcrfrontend.views.html._
@import tags._
@import uk.gov.hmrc.cbcrfrontend.config.FrontendAppConfig
@import uk.gov.hmrc.cbcrfrontend.controllers.routes
@import uk.gov.hmrc.cbcrfrontend.views.html.includes.back_link
@import uk.gov.hmrc.cbcrfrontend.controllers

@this(mainTemplate: Layout, formHelper: FormWithCSRF)

@(userType: Option[AffinityGroup], fileName: Option[String], fileSize: Option[BigDecimal], schemaErrors: Option[Int], busErrors: Option[Int], reportingRole: Option[ReportingRole])(implicit request: Request[_], messages: Messages, config:FrontendAppConfig)

@errors = @{
schemaErrors.isDefined || busErrors.isDefined
}

@mainTemplate(if(!errors) {
    Messages("fileUploadResult.title.ok")
}
else {
    Messages("fileUploadResult.error.title")
}) {

@back_link(controllers.upscan.routes.UploadFormController.onPageLoad.url)

<div>
    @if(!errors) {
    <h1 class="govuk-heading-l" >@Messages("fileUploadResult.mainHeading.ok")</h1>
    } else {
    @if(schemaErrors.isDefined && busErrors.isDefined) {
    <h1 class="govuk-heading-l">@messages("fileUploadResult.mainHeading.xmlDataError")</h1>
    } else {
    @if(schemaErrors.isDefined) {
    <h1 class="govuk-heading-l">@messages("fileUploadResult.mainHeading.xmlError")</h1>
    } else {
    <h1 class="govuk-heading-l">@messages("fileUploadResult.mainHeading.dataError")</h1>
    }
    }
    <h2 class="govuk-heading-m">@messages("fileUploadResult.whatToDo")</h2>
    @schemaErrors.map { size =>
    <p class="govuk-body">@Messages("fileUploadResult.error.report") <a href="@controllers.upscan.routes.FileValidationController.getXmlSchemaErrors" class="govuk-link">@Messages("fileUploadResult.error.data.link")
        (Text, @{
        size
        }KB)</a> @Messages("fileUploadResult.error.data.message")</p>
    }
    @busErrors.map { size =>
    <p class="govuk-body">@Messages("fileUploadResult.error.report") <a href="@controllers.upscan.routes.FileValidationController.getBusinessRuleErrors" class="govuk-link">@Messages("fileUploadResult.error.data.link")
        (Text, @{
        size
        }KB)</a> @Messages("fileUploadResult.error.data.message")</p>
    }
    <p class="govuk-body"><a href="@config.cbcrOecdGuideUrl" class="govuk-link">@Messages("fileUploadResult.error.oecdUrl")</a>@Messages("fileUploadResult.error.oecdInfo")</p>
    }
    @if(!errors) {
    <table class="govuk-table" id="table-successReport">
        <caption class="govuk-table__caption govuk-table__caption--m" tabindex="0">@Messages("fileUploadResult.caption")</caption>
        <thead class="=govuk-table__head">
        <tr class="govuk-table__row">
            <th class="govuk-table__header" tabindex="0"></th>
            <th class="govuk-table__header" tabindex="0"></th>
        </tr>
        </thead>
        <tbody class="govuk-table__body">
        <tr class="govuk-table__row">
            <td class=govuk-table__cell tabindex="0">@Messages("fileUploadResult.fileName")</td>
            <td class=govuk-table__cell tabindex="0">@fileName</td>
        <tr>
            <td class=govuk-table__cell tabindex="0">@Messages("fileUploadResult.fileSize")</td>
            <td class=govuk-table__cell tabindex="0">@fileSize KB</td>
        </tr>
        </tbody>
    </table>
    <p class="govuk-body">@Messages("fileUploadResult.notYetSubmitted") <a href="@routes.SharedController.signOutSurvey">@Messages("fileUploadResult.notYetSubmitted.link")</a> @Messages("fileUploadResult.notYetSubmitted2")</p>

    @if(reportingRole == Some(CBC701)){
    @if(userType == Some(Organisation)){
    <p><a type="submit" class="govuk-button" role="button" href="@routes.SubmissionController.submitterInfo()" id="btn-continue">@Messages("form.controls.continue")</a></p>
    } else {
    <p><a type="submit" class="govuk-button" role="button" href="@routes.SubmissionController.enterCompanyName" id="btn-continue">@Messages("form.controls.continue")</a></p>
    }
    } else {
    <p><a type="submit" class="govuk-button" role="button" href="@routes.SubmissionController.upe" id="btn-continue">@Messages("form.controls.continue")</a></p>
    }
    } else {
    @errorFocus()
    <a type="submit" class="govuk-button" role="button" href="@routes.SharedController.signOutSurvey" id="btn-continue">@Messages("form.controls.finished")</a>
    }
</div>
}
