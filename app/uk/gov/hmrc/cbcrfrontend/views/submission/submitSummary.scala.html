@*
* Copyright 2021 HM Revenue & Customs
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*@
@import java.time.format.DateTimeFormatter
@import uk.gov.hmrc.cbcrfrontend.controllers.routes
@import uk.gov.hmrc.cbcrfrontend.model._
@import uk.gov.hmrc.cbcrfrontend.views.html.Layout
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import uk.gov.hmrc.cbcrfrontend.views.html.includes.back_link
@import uk.gov.hmrc.cbcrfrontend.controllers.routes
@import uk.gov.hmrc.auth.core.AffinityGroup
@import uk.gov.hmrc.auth.core.AffinityGroup._
@import uk.gov.hmrc.cbcrfrontend.util._

@this(
    mainTemplate: Layout,
    formHelper: FormWithCSRF,
    govukSummaryList : GovukSummaryList
)

@(summaryData: SummaryData, userType: Option[AffinityGroup])(implicit request: Request[_], messages: Messages)




@fileTimeStamp = {
    @summaryData.xmlInfo.messageSpec.timestamp.format(DateTimeFormatter.ofPattern(if (summaryData.doesCreationTimeStampHaveMillis) "yyyy-MM-dd HH:mm:ss.SSS" else "yyyy-MM-dd HH:mm:ss"))
}

@mainTemplate(Messages("submitSummary.title")) {
    @{
        userType match {
            case Some(Organisation) => back_link(routes.SharedController.enterCBCId.url)
            case _ => back_link(routes.SharedController.knownFactsMatch.url)
        }
    }


                @* Company or partnership details *@
                <h1 class="govuk-heading-l">@Messages("submitSummary.mainHeading")</h1>

                <h2 class="govuk-heading-m" data-spec="company-details-heading">@Messages("submitSummary.companyDetails.heading")</h2>
                @govukSummaryList(SummaryList(
                    attributes = Map("data-spec"->"company-details"),
                    classes = "govuk-!-margin-bottom-9",
                    rows = Seq(
                        SummaryListRow(
                            key = Key(
                                content = Text(Messages("submitSummary.companyDetails.cbcId"))
                            ),
                            value = Value(
                                content = Text(summaryData.submissionMetaData.submissionInfo.cbcId.toString)
                            ),
                            actions = None
                        ),
                        SummaryListRow(
                            key = Key(
                                content = Text(Messages("submitSummary.companyDetails.companyName"))
                            ),
                            value = Value(
                                content = Text(summaryData.submissionMetaData.submissionInfo.ultimateParentEntity.ultimateParentEntity.toString)
                            ),
                            actions = None
                        ),
                        SummaryListRow(
                            key = Key(
                                content = Text(Messages("submitSummary.companyDetails.utr"))
                            ),
                            value = Value(
                                content = Text(summaryData.submissionMetaData.submissionInfo.tin.value)
                            ),
                            actions = None
                        )
                    )
                ))

                <h2 class="govuk-heading-m" data-spec="contact-details-heading">@Messages("submitSummary.contactDetails.heading")</h2>
                @govukSummaryList(SummaryList(
                    attributes = Map("data-spec"->"contact-details"),
                    classes = "govuk-!-margin-bottom-9",
                    rows = Seq(
                        SummaryListRow(
                            key = Key(
                                content = Text(Messages("submitSummary.contactDetails.name"))
                            ),
                            value = Value(
                                content = Text(summaryData.submissionMetaData.submitterInfo.fullName)
                            ),
                            actions = Some(Actions(
                                items = Seq(
                                    ActionItem(
                                    href = routes.SubmissionController.submitterInfo(Some("fullName")).toString,
                                    content = Text(Messages("submitSummary.contactDetails.change")),
                                    visuallyHiddenText = Some(Messages("submitSummary.contactDetails.name")),
                                    attributes = Map("id"->"change-contact-name")
                                    )
                                )
                            ))
                        ),
                        SummaryListRow(
                            key = Key(
                                content = Text(Messages("submitSummary.contactDetails.phone"))
                            ),
                            value = Value(
                                content = Text(summaryData.submissionMetaData.submitterInfo.contactPhone)
                            ),
                            actions = Some(Actions(
                                items = Seq(
                                    ActionItem(
                                    href = routes.SubmissionController.submitterInfo(Some("contactPhone")).toString,
                                    content = Text(Messages("submitSummary.contactDetails.change")),
                                    visuallyHiddenText = Some(Messages("submitSummary.contactDetails.phone")),
                                    attributes = Map("id"->"change-contact-phone")
                                    )
                                )
                            ))
                        ),
                        SummaryListRow(
                            key = Key(
                                content = Text(Messages("submitSummary.contactDetails.email"))
                            ),
                            value = Value(
                                content = Text(summaryData.submissionMetaData.submitterInfo.email)
                            ),
                            actions = Some(Actions(
                                items = Seq(
                                    ActionItem(
                                    href = routes.SubmissionController.submitterInfo(Some("email")).toString,
                                    content = Text(Messages("submitSummary.contactDetails.change")),
                                    visuallyHiddenText = Some(Messages("submitSummary.contactDetails.email")),
                                    attributes = Map("id"->"change-contact-email")
                                    )
                                )
                            ))
                        )
                    )
                ))



                <h2 class="govuk-heading-m" data-spec="report-details-heading">@Messages("submitSummary.reportDetails.heading")</h2>

                @govukSummaryList(SummaryList(
                    attributes = Map("data-spec"->"report-details"),
                    classes = "govuk-!-margin-bottom-9",
                    rows = Seq(
                        SummaryListRow(
                            key = Key(
                                content = Text(Messages("submitSummary.reportDetails.filename"))
                            ),
                            value = Value(
                                content = Text({UIHelper.fileNameAndLength(summaryData.submissionMetaData.fileInfo)._1})
                            ),
                            actions = None
                        ),
                        SummaryListRow(
                            key = Key(
                                content = Text(Messages("submitSummary.reportDetails.fileSize"))
                            ),
                            value = Value(
                                content = Text(ModifySize.calculateFileSize({UIHelper.fileNameAndLength(summaryData.submissionMetaData.fileInfo)_2}) + "KB")
                            ),
                            actions = None
                        ),
                        SummaryListRow(
                            key = Key(
                                content = Text(Messages("submitSummary.reportDetails.period"))
                            ),
                            value = Value(
                                content = Text(summaryData.xmlInfo.messageSpec.reportingPeriod.toString)
                            ),
                            actions = None
                        ),
                        SummaryListRow(
                            key = Key(
                                content = Text(Messages("submitSummary.reportDetails.timestamp"))
                            ),
                            value = Value(
                                content = Text(fileTimeStamp.toString)
                            ),
                            actions = None
                        )
                    )
                ))

            @formHelper(uk.gov.hmrc.cbcrfrontend.controllers.routes.SubmissionController.confirm) {

                <p class="govuk-body" data-spec="declaration-text">@Messages("submitSummary.declaration.text")<p>
                <button type="submit" class="govuk-button" id="btn-submitSummary">@Messages("submitSummary.submit")</button>

            }

}
